<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ArchiveMind ‚Äì Field Research Intelligence</title>
<link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,500;0,600;1,400&family=DM+Sans:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --cream:        #FAF7F2;
    --parchment:    #F3EDE3;
    --warm-white:   #FDFAF6;
    --sand:         #E8DDD0;
    --sand-dark:    #D4C8B8;
    --coral:        #CF6A4C;
    --coral-light:  #E07B5A;
    --coral-dark:   #B85A3A;
    --rust:         #8B3A1F;
    --amber:        #C4844A;
    --amber-light:  #E0A060;
    --sage:         #6B8C7A;
    --sage-light:   #8BA898;
    --ink:          #2A2420;
    --ink-mid:      #4A3F38;
    --ink-soft:     #6B5E55;
    --ink-muted:    #9A8B82;
    --ink-ghost:    #C4B8B0;
    --sidebar-bg:   #F0E9DF;
    --panel-bg:     #F8F4EE;
    --card-bg:      #FDFAF6;
    --border:       #E0D8CC;
    --border-light: #EDE8E0;
    --glow-coral:   rgba(207,106,76,0.12);
    --glow-amber:   rgba(196,132,74,0.10);
    --node-color:   #CF6A4C;
    --node-edge:    rgba(207,106,76,0.35);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--cream);
    color: var(--ink);
    height: 100vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  .tb-btn {
    width: 28px; height: 28px;
    border-radius: 6px;
    border: none;
    background: transparent;
    color: var(--ink-muted);
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    font-size: 14px;
    transition: background 0.15s, color 0.15s;
  }

  .tb-btn:hover { background: var(--sand); color: var(--ink); }
  .tb-btn.active { background: var(--glow-coral); color: var(--coral); }

  /* ‚îÄ‚îÄ‚îÄ Main Layout ‚îÄ‚îÄ‚îÄ */
  .app-body {
    flex: 1;
    display: flex;
    overflow: hidden;
  }

  /* ‚îÄ‚îÄ‚îÄ Icon Rail ‚îÄ‚îÄ‚îÄ */
  .icon-rail {
    width: 56px;
    background: var(--sidebar-bg);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 12px 0;
    gap: 4px;
    flex-shrink: 0;
  }

  .rail-icon {
    width: 40px; height: 40px;
    border-radius: 10px;
    border: none;
    background: transparent;
    color: var(--ink-muted);
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    font-size: 18px;
    transition: all 0.15s;
    position: relative;
  }

  .rail-icon:hover { background: var(--sand); color: var(--ink); }

  .rail-icon.active {
    background: var(--coral);
    color: #fff;
    box-shadow: 0 2px 12px rgba(207,106,76,0.35);
  }

  .rail-icon .badge {
    position: absolute;
    top: 6px; right: 6px;
    width: 7px; height: 7px;
    background: var(--amber);
    border-radius: 50%;
    border: 1.5px solid var(--sidebar-bg);
  }

  .rail-spacer { flex: 1; }

  .rail-avatar {
    width: 32px; height: 32px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--coral), var(--amber));
    display: flex; align-items: center; justify-content: center;
    color: #fff;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    margin-bottom: 4px;
    font-family: 'Lora', serif;
  }

  /* ‚îÄ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ‚îÄ */
  .sidebar {
    width: 240px;
    background: var(--sidebar-bg);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    flex-shrink: 0;
    overflow: hidden;
  }

  .sidebar-header {
    padding: 16px 16px 12px;
    border-bottom: 1px solid var(--border-light);
  }

  .sidebar-title {
    font-family: 'Lora', serif;
    font-size: 15px;
    font-weight: 600;
    color: var(--ink);
    margin-bottom: 10px;
  }

  .search-box {
    display: flex;
    align-items: center;
    gap: 8px;
    background: rgba(255,255,255,0.7);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 7px 10px;
    transition: all 0.2s;
  }

  .search-box:focus-within {
    background: #fff;
    border-color: var(--coral);
    box-shadow: 0 0 0 3px var(--glow-coral);
  }

  .search-box svg { color: var(--ink-muted); flex-shrink: 0; }

  .search-box input {
    border: none; background: transparent;
    font-family: 'DM Sans', sans-serif;
    font-size: 12.5px;
    color: var(--ink);
    outline: none;
    flex: 1;
  }

  .search-box input::placeholder { color: var(--ink-ghost); }

  .sidebar-body {
    flex: 1;
    overflow-y: auto;
    padding: 12px 8px;
  }

  .sidebar-body::-webkit-scrollbar { width: 4px; }
  .sidebar-body::-webkit-scrollbar-track { background: transparent; }
  .sidebar-body::-webkit-scrollbar-thumb { background: var(--sand-dark); border-radius: 2px; }

  .sb-section {
    margin-bottom: 20px;
  }

  .sb-section-label {
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--ink-muted);
    padding: 0 8px;
    margin-bottom: 4px;
  }

  .sb-item {
    display: flex;
    align-items: center;
    gap: 9px;
    padding: 7px 8px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 13px;
    color: var(--ink-mid);
    transition: all 0.15s;
    user-select: none;
  }

  .sb-item:hover { background: rgba(255,255,255,0.6); }

  .sb-item.active {
    background: #fff;
    color: var(--ink);
    font-weight: 500;
    box-shadow: 0 1px 4px rgba(0,0,0,0.06);
  }

  .sb-item .sb-icon {
    font-size: 14px;
    width: 20px;
    text-align: center;
    color: var(--coral);
    flex-shrink: 0;
  }

  .sb-item.active .sb-icon { color: var(--coral); }

  .sb-item .sb-count {
    margin-left: auto;
    font-size: 11px;
    color: var(--ink-ghost);
    background: var(--sand);
    border-radius: 10px;
    padding: 1px 6px;
  }

  .sb-item.active .sb-count {
    background: var(--glow-coral);
    color: var(--coral);
  }

  .sidebar-footer {
    padding: 12px;
    border-top: 1px solid var(--border-light);
  }

  .sync-status {
    display: flex;
    align-items: center;
    gap: 7px;
    font-size: 11.5px;
    color: var(--ink-muted);
    padding: 6px 8px;
    border-radius: 7px;
    background: rgba(255,255,255,0.5);
  }

  .sync-dot {
    width: 7px; height: 7px;
    border-radius: 50%;
    background: var(--sage);
    animation: pulse-sync 2s ease-in-out infinite;
    flex-shrink: 0;
  }

  @keyframes pulse-sync {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(0.8); }
  }

  /* ‚îÄ‚îÄ‚îÄ Note List ‚îÄ‚îÄ‚îÄ */
  .note-list {
    width: 260px;
    background: var(--panel-bg);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    flex-shrink: 0;
  }

  .note-list-header {
    padding: 16px 16px 12px;
    border-bottom: 1px solid var(--border-light);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .note-list-title {
    font-family: 'Lora', serif;
    font-size: 15px;
    font-weight: 600;
    color: var(--ink);
  }

  .icon-btn {
    width: 28px; height: 28px;
    border-radius: 6px;
    border: none;
    background: transparent;
    color: var(--ink-muted);
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    font-size: 15px;
    transition: all 0.15s;
  }

  .icon-btn:hover { background: var(--sand); color: var(--ink); }

  .icon-btn.primary {
    background: var(--coral);
    color: #fff;
    box-shadow: 0 2px 8px rgba(207,106,76,0.3);
  }

  .icon-btn.primary:hover { background: var(--coral-light); }

  .note-list-body {
    flex: 1;
    overflow-y: auto;
    padding: 8px;
  }

  .note-list-body::-webkit-scrollbar { width: 4px; }
  .note-list-body::-webkit-scrollbar-thumb { background: var(--sand-dark); border-radius: 2px; }

  .note-card {
    padding: 12px;
    border-radius: 10px;
    cursor: pointer;
    margin-bottom: 4px;
    border: 1.5px solid transparent;
    transition: all 0.15s;
    background: transparent;
  }

  .note-card:hover { background: rgba(255,255,255,0.7); }

  .note-card.active {
    background: var(--card-bg);
    border-color: var(--border);
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  }

  .nc-top {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 8px;
    margin-bottom: 5px;
  }

  .nc-title {
    font-size: 13.5px;
    font-weight: 500;
    color: var(--ink);
    line-height: 1.3;
    font-family: 'Lora', serif;
  }

  .nc-type {
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.05em;
    padding: 2px 7px;
    border-radius: 20px;
    flex-shrink: 0;
  }

  .type-interview {
    background: rgba(207,106,76,0.12);
    color: var(--coral-dark);
  }

  .type-photo {
    background: rgba(107,140,122,0.12);
    color: var(--sage);
  }

  .type-memo {
    background: rgba(196,132,74,0.12);
    color: var(--amber);
  }

  .type-field {
    background: rgba(42,36,32,0.07);
    color: var(--ink-soft);
  }

  .nc-excerpt {
    font-size: 12px;
    color: var(--ink-muted);
    line-height: 1.5;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .nc-meta {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 7px;
  }

  .nc-meta-item {
    display: flex;
    align-items: center;
    gap: 3px;
    font-size: 10.5px;
    color: var(--ink-ghost);
  }

  .nc-tags {
    display: flex;
    gap: 4px;
    flex-wrap: wrap;
    margin-top: 6px;
  }

  .nc-tag {
    font-size: 10px;
    padding: 1.5px 6px;
    border-radius: 4px;
    background: var(--sand);
    color: var(--ink-soft);
  }

  /* ‚îÄ‚îÄ‚îÄ Editor Area ‚îÄ‚îÄ‚îÄ */
  .editor-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    background: var(--warm-white);
  }

  /* ‚îÄ‚îÄ‚îÄ Editor Toolbar (two rows) ‚îÄ‚îÄ‚îÄ */
  .editor-toolbar {
    display: flex;
    flex-direction: column;
    border-bottom: 1px solid var(--border);
    background: var(--warm-white);
    flex-shrink: 0;
  }

  /* Top row: view switcher left, app actions right */
  .toolbar-row-top {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 20px;
    border-bottom: 1px solid var(--border-light);
    gap: 12px;
  }

  .toolbar-view-tabs {
    display: flex;
    align-items: center;
    gap: 2px;
    background: var(--parchment);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 3px;
  }

  .view-tab {
    display: flex;
    align-items: center;
    gap: 5px;
    padding: 5px 12px;
    border-radius: 6px;
    border: none;
    background: transparent;
    color: var(--ink-muted);
    cursor: pointer;
    font-size: 12.5px;
    font-family: 'DM Sans', sans-serif;
    font-weight: 500;
    transition: all 0.15s;
    white-space: nowrap;
  }

  .view-tab:hover { background: rgba(255,255,255,0.7); color: var(--ink); }

  .view-tab.active {
    background: #fff;
    color: var(--ink);
    font-weight: 600;
    box-shadow: 0 1px 4px rgba(0,0,0,0.07);
  }

  .toolbar-app-actions {
    display: flex;
    align-items: center;
    gap: 4px;
  }

  /* Bottom row: formatting tools */
  .toolbar-row-bottom {
    display: flex;
    align-items: center;
    padding: 6px 20px;
    gap: 4px;
  }

  .toolbar-group {
    display: flex;
    align-items: center;
    gap: 1px;
    padding: 0 8px;
    border-right: 1px solid var(--border-light);
  }

  .toolbar-group:first-child { padding-left: 0; }
  .toolbar-group:last-child  { border-right: none; }

  .tool-btn {
    padding: 5px 8px;
    border-radius: 6px;
    border: none;
    background: transparent;
    color: var(--ink-muted);
    cursor: pointer;
    font-size: 12.5px;
    font-family: 'DM Sans', sans-serif;
    font-weight: 500;
    display: flex; align-items: center; gap: 5px;
    transition: all 0.15s;
    white-space: nowrap;
  }

  .tool-btn:hover { background: var(--parchment); color: var(--ink); }
  .tool-btn.active { color: var(--coral); background: var(--glow-coral); }
  .tool-btn svg { font-size: 14px; }

  .toolbar-spacer { flex: 1; }

  .entity-chip {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 4px 10px;
    background: rgba(207,106,76,0.08);
    border: 1px solid rgba(207,106,76,0.2);
    border-radius: 20px;
    font-size: 11.5px;
    color: var(--coral-dark);
    cursor: pointer;
    transition: all 0.15s;
  }

  .entity-chip:hover { background: rgba(207,106,76,0.15); }

  /* ‚îÄ‚îÄ‚îÄ Editor Content ‚îÄ‚îÄ‚îÄ */
  .editor-content {
    flex: 1;
    overflow-y: auto;
    padding: 40px 60px;
    max-width: 780px;
    margin: 0 auto;
    width: 100%;
  }

  .editor-content::-webkit-scrollbar { width: 4px; }
  .editor-content::-webkit-scrollbar-thumb { background: var(--sand-dark); border-radius: 2px; }

  .note-heading {
    font-family: 'Lora', serif;
    font-size: 28px;
    font-weight: 600;
    color: var(--ink);
    line-height: 1.25;
    margin-bottom: 6px;
    border: none;
    background: transparent;
    width: 100%;
    outline: none;
    resize: none;
    overflow: hidden;
  }

  .note-meta-bar {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 24px;
    padding-bottom: 16px;
    border-bottom: 1px solid var(--border-light);
    flex-wrap: wrap;
  }

  .meta-chip {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 11.5px;
    color: var(--ink-muted);
    background: var(--parchment);
    border: 1px solid var(--border-light);
    padding: 3px 9px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.15s;
  }

  .meta-chip:hover { border-color: var(--coral); color: var(--coral); }

  .meta-chip .icon { font-size: 12px; }

  .entity-mention {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    background: rgba(207,106,76,0.10);
    border: 1px solid rgba(207,106,76,0.25);
    border-radius: 5px;
    padding: 1px 7px;
    font-size: 13px;
    color: var(--coral-dark);
    font-weight: 500;
    cursor: pointer;
    font-family: 'DM Sans', sans-serif;
    transition: all 0.15s;
    vertical-align: middle;
    text-decoration: none;
  }

  .entity-mention:hover {
    background: rgba(207,106,76,0.18);
    border-color: var(--coral);
  }

  .concept-tag {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    background: rgba(107,140,122,0.10);
    border: 1px solid rgba(107,140,122,0.25);
    border-radius: 5px;
    padding: 1px 7px;
    font-size: 13px;
    color: var(--sage);
    font-weight: 500;
    cursor: pointer;
    font-family: 'DM Sans', sans-serif;
    transition: all 0.15s;
    vertical-align: middle;
  }

  .concept-tag:hover {
    background: rgba(107,140,122,0.18);
    border-color: var(--sage);
  }

  .location-tag {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    background: rgba(196,132,74,0.10);
    border: 1px solid rgba(196,132,74,0.25);
    border-radius: 5px;
    padding: 1px 7px;
    font-size: 13px;
    color: var(--amber);
    font-weight: 500;
    cursor: pointer;
    font-family: 'DM Sans', sans-serif;
    transition: all 0.15s;
    vertical-align: middle;
  }

  .note-body {
    font-size: 15px;
    line-height: 1.8;
    color: var(--ink-mid);
    font-family: 'Lora', serif;
  }

  .note-body p { margin-bottom: 1em; }

  .note-body blockquote {
    border-left: 3px solid var(--coral);
    padding-left: 16px;
    color: var(--ink-soft);
    font-style: italic;
    margin: 1.2em 0;
    background: rgba(207,106,76,0.04);
    padding: 12px 16px;
    border-radius: 0 8px 8px 0;
  }

  .inline-audio {
    display: flex;
    align-items: center;
    gap: 12px;
    background: var(--parchment);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 10px 14px;
    margin: 12px 0;
  }

  .audio-play-btn {
    width: 34px; height: 34px;
    border-radius: 50%;
    background: var(--coral);
    border: none;
    color: #fff;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    font-size: 13px;
    flex-shrink: 0;
    transition: all 0.15s;
  }

  .audio-play-btn:hover { background: var(--coral-light); transform: scale(1.05); }

  .audio-waveform {
    flex: 1;
    height: 24px;
    display: flex;
    align-items: center;
    gap: 2px;
  }

  .wave-bar {
    width: 3px;
    border-radius: 2px;
    background: var(--coral);
    opacity: 0.6;
    animation: wave-anim var(--dur, 1s) ease-in-out infinite alternate;
    animation-delay: var(--delay, 0s);
  }

  @keyframes wave-anim {
    from { height: 4px; }
    to { height: var(--h, 16px); }
  }

  .audio-duration {
    font-size: 11px;
    font-family: 'JetBrains Mono', monospace;
    color: var(--ink-muted);
    flex-shrink: 0;
  }

  .transcription-badge {
    font-size: 10px;
    padding: 2px 7px;
    border-radius: 20px;
    background: rgba(107,140,122,0.12);
    color: var(--sage);
    font-weight: 600;
    flex-shrink: 0;
  }

  /* Entity Panel (right) */
  .entity-panel {
    width: 280px;
    background: var(--parchment);
    border-left: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    flex-shrink: 0;
    overflow: hidden;
  }

  .entity-panel-header {
    padding: 16px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .ep-title {
    font-family: 'Lora', serif;
    font-size: 13.5px;
    font-weight: 600;
    color: var(--ink);
  }

  .ep-tabs {
    display: flex;
    gap: 2px;
    padding: 8px 12px;
    border-bottom: 1px solid var(--border-light);
  }

  .ep-tab {
    flex: 1;
    padding: 5px;
    text-align: center;
    font-size: 11.5px;
    font-weight: 500;
    border-radius: 6px;
    cursor: pointer;
    color: var(--ink-muted);
    transition: all 0.15s;
    border: none;
    background: transparent;
  }

  .ep-tab.active {
    background: #fff;
    color: var(--coral);
    box-shadow: 0 1px 4px rgba(0,0,0,0.07);
  }

  .ep-body {
    flex: 1;
    overflow-y: auto;
    padding: 12px;
  }

  .ep-body::-webkit-scrollbar { width: 4px; }
  .ep-body::-webkit-scrollbar-thumb { background: var(--sand-dark); border-radius: 2px; }

  /* Entity Profile Card */
  .entity-profile {
    background: #fff;
    border-radius: 12px;
    padding: 14px;
    margin-bottom: 10px;
    border: 1px solid var(--border-light);
    box-shadow: 0 1px 4px rgba(0,0,0,0.04);
  }

  .ep-avatar-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
  }

  .ep-avatar {
    width: 38px; height: 38px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--coral), var(--amber));
    display: flex; align-items: center; justify-content: center;
    color: #fff;
    font-size: 14px;
    font-weight: 600;
    font-family: 'Lora', serif;
    flex-shrink: 0;
  }

  .ep-name {
    font-family: 'Lora', serif;
    font-size: 14px;
    font-weight: 600;
    color: var(--ink);
  }

  .ep-role {
    font-size: 11px;
    color: var(--ink-muted);
    margin-top: 1px;
  }

  .ep-stats {
    display: flex;
    gap: 8px;
    margin-bottom: 10px;
  }

  .ep-stat {
    flex: 1;
    text-align: center;
    background: var(--parchment);
    border-radius: 8px;
    padding: 6px;
  }

  .ep-stat-num {
    font-family: 'JetBrains Mono', monospace;
    font-size: 16px;
    font-weight: 500;
    color: var(--coral);
  }

  .ep-stat-lbl {
    font-size: 9.5px;
    color: var(--ink-muted);
    text-transform: uppercase;
    letter-spacing: 0.04em;
    margin-top: 1px;
  }

  .ep-topics {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
  }

  .ep-topic {
    font-size: 10.5px;
    padding: 2px 8px;
    background: var(--parchment);
    border: 1px solid var(--border);
    border-radius: 20px;
    color: var(--ink-soft);
    cursor: pointer;
    transition: all 0.15s;
  }

  .ep-topic:hover { border-color: var(--coral); color: var(--coral); }

  /* Mini Map */
  .mini-map {
    background: #fff;
    border-radius: 12px;
    border: 1px solid var(--border-light);
    overflow: hidden;
    margin-bottom: 10px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.04);
  }

  .mini-map-header {
    padding: 10px 12px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid var(--border-light);
  }

  .mini-map-title {
    font-size: 11.5px;
    font-weight: 600;
    color: var(--ink);
  }

  .map-view {
    height: 140px;
    background: #e8e0d4;
    position: relative;
    overflow: hidden;
  }

  /* Simplified map background */
  .map-view::before {
    content: '';
    position: absolute;
    inset: 0;
    background:
      linear-gradient(to bottom, #d4cfc7 0%, #c8c2b8 100%);
  }

  .map-roads {
    position: absolute;
    inset: 0;
  }

  .map-road {
    position: absolute;
    background: rgba(255,255,255,0.5);
    border-radius: 1px;
  }

  .map-pin {
    position: absolute;
    width: 22px; height: 22px;
    cursor: pointer;
    transform: translate(-50%, -50%);
    transition: transform 0.15s;
  }

  .map-pin:hover { transform: translate(-50%, -50%) scale(1.2); }

  .map-pin-dot {
    width: 12px; height: 12px;
    border-radius: 50%;
    border: 2px solid #fff;
    margin: 5px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.25);
    position: relative;
    z-index: 2;
  }

  .map-pin-pulse {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 24px; height: 24px;
    border-radius: 50%;
    border: 2px solid;
    animation: map-pulse 2s ease-out infinite;
    z-index: 1;
  }

  @keyframes map-pulse {
    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0.8; }
    100% { transform: translate(-50%, -50%) scale(2); opacity: 0; }
  }

  .map-connection-line {
    position: absolute;
    background: rgba(207,106,76,0.5);
    height: 1.5px;
    transform-origin: left center;
  }

  /* Inventory Section */
  .inventory-card {
    background: #fff;
    border-radius: 12px;
    border: 1px solid var(--border-light);
    overflow: hidden;
    margin-bottom: 10px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.04);
  }

  .inv-header {
    padding: 10px 14px;
    border-bottom: 1px solid var(--border-light);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .inv-title {
    font-size: 12px;
    font-weight: 600;
    color: var(--ink);
  }

  .inv-readiness {
    font-size: 10.5px;
    color: var(--sage);
    font-weight: 600;
    background: rgba(107,140,122,0.1);
    padding: 2px 8px;
    border-radius: 20px;
  }

  .inv-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 14px;
    border-bottom: 1px solid var(--border-light);
    transition: background 0.12s;
    cursor: pointer;
  }

  .inv-item:last-child { border-bottom: none; }
  .inv-item:hover { background: var(--parchment); }

  .inv-item-icon { font-size: 16px; flex-shrink: 0; }

  .inv-item-name {
    font-size: 12.5px;
    color: var(--ink-mid);
    flex: 1;
  }

  .inv-status {
    font-size: 10px;
    font-weight: 600;
    padding: 2px 8px;
    border-radius: 20px;
    flex-shrink: 0;
  }

  .status-charged { background: rgba(107,140,122,0.12); color: var(--sage); }
  .status-low     { background: rgba(196,132,74,0.12); color: var(--amber); }
  .status-missing { background: rgba(207,106,76,0.12); color: var(--coral); }

  /* ‚îÄ‚îÄ‚îÄ Knowledge Graph Overlay ‚îÄ‚îÄ‚îÄ */
  .graph-overlay {
    position: fixed;
    inset: 0;
    background: rgba(42,36,32,0.92);
    z-index: 100;
    display: flex;
    flex-direction: column;
    backdrop-filter: blur(4px);
    animation: fade-in 0.3s ease;
  }

  @keyframes fade-in {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .graph-header {
    padding: 16px 24px;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .graph-title {
    font-family: 'Lora', serif;
    font-size: 18px;
    font-weight: 600;
    color: var(--cream);
  }

  .graph-close {
    width: 36px; height: 36px;
    border-radius: 8px;
    border: 1px solid rgba(255,255,255,0.1);
    background: transparent;
    color: var(--ink-ghost);
    cursor: pointer;
    font-size: 16px;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.15s;
  }

  .graph-close:hover { background: rgba(255,255,255,0.08); color: #fff; }

  .graph-canvas {
    flex: 1;
    position: relative;
    overflow: hidden;
  }

  /* SVG Graph */
  .graph-svg {
    width: 100%; height: 100%;
  }

  .graph-node {
    cursor: pointer;
  }

  .graph-node circle {
    transition: r 0.2s, filter 0.2s;
  }

  .graph-node:hover circle {
    filter: brightness(1.2);
  }

  .node-label {
    font-family: 'DM Sans', sans-serif;
    fill: rgba(250,247,242,0.85);
    font-size: 11px;
    pointer-events: none;
  }

  .edge-line {
    stroke-width: 1.5;
    transition: stroke-opacity 0.2s;
  }

  .edge-line:hover {
    stroke-opacity: 1 !important;
  }

  .graph-legend {
    position: absolute;
    bottom: 24px;
    left: 24px;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 11px;
    color: rgba(250,247,242,0.6);
  }

  .legend-dot {
    width: 10px; height: 10px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  .graph-controls {
    position: absolute;
    bottom: 24px;
    right: 24px;
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .graph-ctrl-btn {
    width: 34px; height: 34px;
    border-radius: 8px;
    border: 1px solid rgba(255,255,255,0.12);
    background: rgba(255,255,255,0.06);
    color: rgba(255,255,255,0.7);
    cursor: pointer;
    font-size: 16px;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.15s;
  }

  .graph-ctrl-btn:hover { background: rgba(255,255,255,0.12); color: #fff; }

  /* Floating buttons */
  .fab {
    position: fixed;
    bottom: 28px;
    right: 320px;
    display: flex;
    gap: 8px;
    z-index: 10;
  }

  .fab-btn {
    display: flex;
    align-items: center;
    gap: 7px;
    padding: 10px 18px;
    border-radius: 24px;
    border: none;
    font-family: 'DM Sans', sans-serif;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    box-shadow: 0 4px 16px rgba(0,0,0,0.12);
    transition: all 0.2s;
  }

  .fab-primary {
    background: var(--coral);
    color: #fff;
  }

  .fab-primary:hover {
    background: var(--coral-light);
    transform: translateY(-1px);
    box-shadow: 0 6px 20px rgba(207,106,76,0.4);
  }

  .fab-secondary {
    background: var(--warm-white);
    color: var(--ink);
    border: 1px solid var(--border);
  }

  .fab-secondary:hover {
    background: var(--parchment);
    transform: translateY(-1px);
  }

  /* Inventory warning */
  .inv-alert {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 14px;
    background: rgba(207,106,76,0.08);
    border: 1px solid rgba(207,106,76,0.25);
    border-radius: 10px;
    margin-bottom: 10px;
    cursor: pointer;
    transition: all 0.15s;
  }

  .inv-alert:hover { background: rgba(207,106,76,0.14); }

  .inv-alert-icon { font-size: 16px; flex-shrink: 0; }

  .inv-alert-text {
    font-size: 12px;
    color: var(--coral-dark);
    font-weight: 500;
    flex: 1;
  }

  .inv-alert-count {
    font-size: 11px;
    font-weight: 700;
    background: var(--coral);
    color: #fff;
    border-radius: 20px;
    padding: 1px 7px;
    flex-shrink: 0;
  }

  /* Connected notes section */
  .connected-note {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    padding: 9px 10px;
    border-radius: 9px;
    cursor: pointer;
    margin-bottom: 4px;
    border: 1px solid transparent;
    transition: all 0.15s;
    background: transparent;
  }

  .connected-note:hover {
    background: #fff;
    border-color: var(--border);
  }

  .cn-icon { font-size: 14px; flex-shrink: 0; margin-top: 1px; }
  .cn-info { flex: 1; min-width: 0; }

  .cn-title {
    font-size: 12.5px;
    font-weight: 500;
    color: var(--ink);
    margin-bottom: 2px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    font-family: 'Lora', serif;
  }

  .cn-meta {
    font-size: 10.5px;
    color: var(--ink-muted);
  }

  .cn-strength {
    display: flex;
    gap: 2px;
    flex-shrink: 0;
    align-items: center;
    margin-top: 3px;
  }

  .strength-bar {
    width: 4px;
    height: 12px;
    border-radius: 2px;
  }

  /* Tooltip */
  .tooltip-area {
    position: relative;
  }

  .tooltip-area::after {
    content: attr(data-tip);
    position: absolute;
    bottom: calc(100% + 6px);
    left: 50%;
    transform: translateX(-50%);
    background: var(--ink);
    color: #fff;
    font-size: 11px;
    padding: 3px 8px;
    border-radius: 5px;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.15s;
    font-family: 'DM Sans', sans-serif;
    z-index: 50;
  }

  .tooltip-area:hover::after { opacity: 1; }

  /* Offline indicator */
  .offline-bar {
    display: none;
    align-items: center;
    gap: 8px;
    padding: 7px 16px;
    background: rgba(196,132,74,0.12);
    border-bottom: 1px solid rgba(196,132,74,0.25);
    font-size: 12px;
    color: var(--amber);
    font-weight: 500;
  }

  /* Photo strip */
  .photo-strip {
    display: flex;
    gap: 8px;
    margin: 12px 0;
    overflow-x: auto;
    padding-bottom: 4px;
  }

  .photo-strip::-webkit-scrollbar { height: 3px; }
  .photo-strip::-webkit-scrollbar-thumb { background: var(--sand-dark); border-radius: 2px; }

  .photo-thumb {
    width: 80px; height: 70px;
    border-radius: 8px;
    background: var(--parchment);
    border: 1.5px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    cursor: pointer;
    font-size: 24px;
    transition: all 0.15s;
    overflow: hidden;
    position: relative;
  }

  .photo-thumb:hover { border-color: var(--coral); transform: scale(1.03); }

  .photo-thumb-meta {
    position: absolute;
    bottom: 0; left: 0; right: 0;
    padding: 4px;
    background: linear-gradient(transparent, rgba(42,36,32,0.6));
    font-size: 9px;
    color: rgba(255,255,255,0.9);
    font-family: 'JetBrains Mono', monospace;
    text-align: center;
  }

  /* Separator */
  .h-rule {
    border: none;
    border-top: 1px solid var(--border-light);
    margin: 20px 0;
  }

  /* ‚îÄ‚îÄ‚îÄ Notifications / Status Bar ‚îÄ‚îÄ‚îÄ */
  .status-bar {
    height: 26px;
    background: var(--sidebar-bg);
    border-top: 1px solid var(--border-light);
    display: flex;
    align-items: center;
    padding: 0 16px;
    gap: 16px;
    font-size: 11px;
    color: var(--ink-muted);
    flex-shrink: 0;
  }

  .status-item {
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .status-dot {
    width: 6px; height: 6px;
    border-radius: 50%;
  }

  .routine-banner {
    display: flex;
    align-items: center;
    gap: 12px;
    margin: 16px 0;
    padding: 12px 16px;
    background: linear-gradient(135deg, rgba(207,106,76,0.06), rgba(196,132,74,0.06));
    border: 1px solid rgba(207,106,76,0.2);
    border-radius: 12px;
  }

  .routine-banner-icon { font-size: 20px; flex-shrink: 0; }

  .routine-banner-info { flex: 1; }

  .routine-banner-title {
    font-size: 13px;
    font-weight: 600;
    color: var(--ink);
    margin-bottom: 2px;
  }

  .routine-banner-sub {
    font-size: 11px;
    color: var(--ink-muted);
  }

  .routine-start-btn {
    padding: 7px 14px;
    border-radius: 8px;
    background: var(--coral);
    border: none;
    color: #fff;
    font-size: 12.5px;
    font-weight: 600;
    cursor: pointer;
    font-family: 'DM Sans', sans-serif;
    transition: all 0.15s;
    flex-shrink: 0;
  }

  .routine-start-btn:hover { background: var(--coral-light); }

  /* Hidden graph overlay by default */
  #graphOverlay { display: none; }
  #graphOverlay.visible { display: flex; }

  /* Transitions */
  .fade-in {
    animation: fade-in 0.25s ease;
  }
</style>
</head>
<body>


<div class="app-body">

  <!-- Icon Rail -->
  <div class="icon-rail">
    <button class="rail-icon active tooltip-area" data-tip="Field Journal">üìì</button>
    <button class="rail-icon tooltip-area" data-tip="Knowledge Graph" onclick="showGraph()">üï∏</button>
    <button class="rail-icon tooltip-area" data-tip="Map View">üó∫</button>
    <button class="rail-icon tooltip-area" data-tip="Entities">üë§</button>
    <button class="rail-icon tooltip-area" data-tip="Inventory">üéí
      <div class="badge"></div>
    </button>
    <button class="rail-icon tooltip-area" data-tip="Routines">üìã</button>
    <div class="rail-spacer"></div>
    <div class="rail-avatar">AK</div>
  </div>

  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-header">
      <!-- App identity (replaces titlebar) -->
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:12px">
        <div style="width:26px;height:26px;border-radius:7px;background:var(--coral);display:flex;align-items:center;justify-content:center;font-family:'Lora',serif;font-size:12px;font-weight:600;color:#fff;flex-shrink:0;box-shadow:0 2px 6px rgba(207,106,76,0.3)">A</div>
        <span style="font-family:'Lora',serif;font-size:14px;font-weight:600;color:var(--ink);letter-spacing:-0.01em">ArchiveMind</span>
      </div>
      <div class="sidebar-title">Field Research</div>
      <div class="search-box">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2">
          <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
        </svg>
        <input type="text" placeholder="Search notes, entities‚Ä¶" />
      </div>
    </div>

    <div class="sidebar-body">
      <div class="sb-section">
        <div class="sb-section-label">Workspace</div>
        <div class="sb-item active">
          <span class="sb-icon">üìì</span>
          All Notes
          <span class="sb-count">47</span>
        </div>
        <div class="sb-item">
          <span class="sb-icon">‚≠ê</span>
          Starred
          <span class="sb-count">8</span>
        </div>
        <div class="sb-item">
          <span class="sb-icon">üóë</span>
          Trash
        </div>
      </div>

      <div class="sb-section">
        <div class="sb-section-label">Field Trips</div>
        <div class="sb-item">
          <span class="sb-icon">üåø</span>
          Kandy Highlands
          <span class="sb-count">18</span>
        </div>
        <div class="sb-item">
          <span class="sb-icon">üåä</span>
          Galle Coastal
          <span class="sb-count">12</span>
        </div>
        <div class="sb-item">
          <span class="sb-icon">üèî</span>
          Ella Caves Survey
          <span class="sb-count">9</span>
        </div>
        <div class="sb-item">
          <span class="sb-icon">üå∫</span>
          Colombo Urban
          <span class="sb-count">8</span>
        </div>
      </div>

      <div class="sb-section">
        <div class="sb-section-label">Concepts</div>
        <div class="sb-item">
          <span class="sb-icon">üåø</span>
          Traditional Medicine
          <span class="sb-count">11</span>
        </div>
        <div class="sb-item">
          <span class="sb-icon">üéã</span>
          Forest Ecology
          <span class="sb-count">7</span>
        </div>
        <div class="sb-item">
          <span class="sb-icon">üè∫</span>
          Ritual Practices
          <span class="sb-count">6</span>
        </div>
      </div>

      <div class="sb-section">
        <div class="sb-section-label">Entity Types</div>
        <div class="sb-item">
          <span class="sb-icon">üë§</span>
          Interviewees
          <span class="sb-count">14</span>
        </div>
        <div class="sb-item">
          <span class="sb-icon">üìç</span>
          Locations
          <span class="sb-count">23</span>
        </div>
        <div class="sb-item">
          <span class="sb-icon">üíä</span>
          Artifacts
          <span class="sb-count">31</span>
        </div>
      </div>
    </div>

    <div class="sidebar-footer">
      <div class="sync-status">
        <div class="sync-dot" id="syncDot"></div>
        <span id="syncText">Synced ¬∑ 2 min ago</span>
      </div>
    </div>
  </div>

  <!-- Note List -->
  <div class="note-list">
    <div class="note-list-header">
      <div class="note-list-title">All Notes</div>
      <div style="display:flex;gap:4px">
        <button class="icon-btn">‚ãÆ</button>
        <button class="icon-btn primary">+</button>
      </div>
    </div>

    <div class="note-list-body">
      <!-- Active Note -->
      <div class="note-card active">
        <div class="nc-top">
          <div class="nc-title">Herbal Healer of Kandy Interview</div>
          <span class="nc-type type-interview">Interview</span>
        </div>
        <div class="nc-excerpt">Priya Ratnam described the lunar harvesting cycles used for medicinal plants. She mentioned 14 herbs specific to the highlands‚Ä¶</div>
        <div class="nc-meta">
          <div class="nc-meta-item">üìç Kandy</div>
          <div class="nc-meta-item">üïê 2h ago</div>
          <div class="nc-meta-item">üîä 23:14</div>
        </div>
        <div class="nc-tags">
          <span class="nc-tag">#medicine</span>
          <span class="nc-tag">#ritual</span>
          <span class="nc-tag">#kandy</span>
        </div>
      </div>

      <div class="note-card">
        <div class="nc-top">
          <div class="nc-title">Galle Coastal Plant Survey</div>
          <span class="nc-type type-field">Field Note</span>
        </div>
        <div class="nc-excerpt">Identified 6 coastal mangrove species. Local fisherman Nimal referenced similar healing plants to those in Kandy highlands‚Ä¶</div>
        <div class="nc-meta">
          <div class="nc-meta-item">üìç Galle</div>
          <div class="nc-meta-item">üïê Yesterday</div>
          <div class="nc-meta-item">üì∏ 12</div>
        </div>
        <div class="nc-tags">
          <span class="nc-tag">#coastal</span>
          <span class="nc-tag">#ecology</span>
        </div>
      </div>

      <div class="note-card">
        <div class="nc-top">
          <div class="nc-title">Voice Memo: Forest Trail</div>
          <span class="nc-type type-memo">Voice</span>
        </div>
        <div class="nc-excerpt">Auto-transcribed ¬∑ GPS: 7.3¬∞N, 80.6¬∞E ¬∑ Clear conditions ¬∑ 28¬∞C ‚Äî described the 300-year-old ayurvedic garden trail‚Ä¶</div>
        <div class="nc-meta">
          <div class="nc-meta-item">üìç Peradeniya</div>
          <div class="nc-meta-item">üïê Yesterday</div>
          <div class="nc-meta-item">üîä 08:42</div>
        </div>
        <div class="nc-tags">
          <span class="nc-tag">#ayurveda</span>
        </div>
      </div>

      <div class="note-card">
        <div class="nc-top">
          <div class="nc-title">Ritual Ceremony Documentation</div>
          <span class="nc-type type-photo">Photos</span>
        </div>
        <div class="nc-excerpt">Photographed full ceremony cycle. Elder confirmed this is a biannual harvest blessing ‚Äî 47 photos, 3 video clips captured‚Ä¶</div>
        <div class="nc-meta">
          <div class="nc-meta-item">üìç Ella</div>
          <div class="nc-meta-item">üïê 3 days ago</div>
          <div class="nc-meta-item">üì∏ 47</div>
        </div>
        <div class="nc-tags">
          <span class="nc-tag">#ritual</span>
          <span class="nc-tag">#ella</span>
        </div>
      </div>

      <div class="note-card">
        <div class="nc-top">
          <div class="nc-title">Market Vendor Conversations</div>
          <span class="nc-type type-interview">Interview</span>
        </div>
        <div class="nc-excerpt">Three vendors confirm the trade route for dried herbs follows the ancient southern corridor. Cross-reference with‚Ä¶</div>
        <div class="nc-meta">
          <div class="nc-meta-item">üìç Colombo</div>
          <div class="nc-meta-item">üïê 4 days ago</div>
          <div class="nc-meta-item">üîä 41:08</div>
        </div>
        <div class="nc-tags">
          <span class="nc-tag">#trade</span>
          <span class="nc-tag">#markets</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Editor Area -->
  <div class="editor-area">
    <!-- Toolbar ‚Äî two rows -->
    <div class="editor-toolbar">

      <!-- Row 1: View switcher + App actions -->
      <div class="toolbar-row-top">
        <div class="toolbar-view-tabs">
          <button class="view-tab active">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
            Notes
          </button>
          <button class="view-tab">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
            Map
          </button>
          <button class="view-tab" onclick="showGraph()">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
            Graph
          </button>
        </div>

        <div class="toolbar-app-actions">
          <button class="tb-btn tooltip-area" data-tip="Offline Mode" id="offlineToggle" onclick="toggleOffline()">üì°</button>
          <button class="tb-btn tooltip-area active" data-tip="Knowledge Graph" onclick="showGraph()">üï∏</button>
          <button class="tb-btn tooltip-area" data-tip="Export">‚¨Ü</button>
          <button class="tb-btn tooltip-area" data-tip="Settings">‚öô</button>
        </div>
      </div>

      <!-- Row 2: Formatting + Insert tools -->
      <div class="toolbar-row-bottom">
        <div class="toolbar-group">
          <button class="tool-btn"><b>B</b></button>
          <button class="tool-btn"><i>I</i></button>
          <button class="tool-btn" style="text-decoration:underline">U</button>
          <button class="tool-btn">H1</button>
          <button class="tool-btn">H2</button>
        </div>
        <div class="toolbar-group">
          <button class="tool-btn">‚Äî Quote</button>
          <button class="tool-btn">‚Ä¢ List</button>
        </div>
        <div class="toolbar-group">
          <button class="tool-btn">[[Entity]]</button>
          <button class="tool-btn">üîä Voice</button>
          <button class="tool-btn">üì∏ Photo</button>
        </div>
      </div>
    </div>

    <!-- Editor Content -->
    <div class="editor-content">
      <!-- Title -->
      <textarea class="note-heading" rows="1" oninput="this.style.height='auto';this.style.height=this.scrollHeight+'px'">Herbal Healer of Kandy: Interview with Priya Ratnam</textarea>

      <!-- Meta bar -->
      <div class="note-meta-bar">
        <div class="entity-chip">
          üë§ Priya Ratnam
        </div>
        <div class="meta-chip">
          <span class="icon">üìç</span>
          Kandy Highlands ¬∑ 7.2906¬∞N, 80.6337¬∞E
        </div>
        <div class="meta-chip">
          <span class="icon">üå§</span>
          28¬∞C ¬∑ Partly Cloudy
        </div>
        <div class="meta-chip">
          <span class="icon">üïê</span>
          09:32 ‚Äì 11:04 ¬∑ 14 Jul 2025
        </div>
        <div class="meta-chip" style="color:var(--sage);border-color:rgba(107,140,122,0.3);background:rgba(107,140,122,0.07)">
          <span class="icon">‚úì</span>
          AI Transcribed
        </div>
      </div>

      <!-- Routine Banner -->
      <div class="routine-banner">
        <div class="routine-banner-icon">üìã</div>
        <div class="routine-banner-info">
          <div class="routine-banner-title">Routine: Deep Forest Interview</div>
          <div class="routine-banner-sub">Camera ‚úì ¬∑ External Mic ‚úì ¬∑ Powerbank ‚ö† Low Battery</div>
        </div>
        <button class="routine-start-btn">Start Trip ‚Üí</button>
      </div>

      <!-- Audio Voice Memo -->
      <div class="inline-audio">
        <button class="audio-play-btn">‚ñ∂</button>
        <div class="audio-waveform" id="waveform"></div>
        <span class="audio-duration">23:14</span>
        <span class="transcription-badge">‚úì Transcribed</span>
      </div>

      <!-- Body content -->
      <div class="note-body">
        <p>
          <a class="entity-mention">üë§ Priya Ratnam</a> is a third-generation Ayurvedic practitioner based in the upper Kandy district.
          She has maintained a private healing garden for over 40 years, cultivating more than 200 species of
          medicinal plants. Unlike contemporary practitioners, her methods remain entirely oral tradition‚Äî
          no written records, only memory and practice.
        </p>

        <blockquote>
          "We harvest by the moon. The sap moves up when the moon is full, so we take the leaves then.
          Roots are taken during the dark phase. This is not superstition‚Äîit is centuries of careful observation."
        </blockquote>

        <p>
          She described 14 plants unique to the <a class="location-tag">üìç Kandy Highlands</a> that she uses for anti-inflammatory treatments.
          Notably, three of these species‚Äîincluding <em>Sida rhombifolia</em>‚Äîwere also referenced by
          <a class="entity-mention">üë§ Nimal Bandara</a> during the <a class="location-tag">üìç Galle Coastal</a> survey,
          suggesting a <a class="concept-tag">üåø Traditional Medicine</a> trade corridor between the two regions.
        </p>

        <!-- Photo strip -->
        <div class="photo-strip">
          <div class="photo-thumb">üåø<div class="photo-thumb-meta">Sida r.</div></div>
          <div class="photo-thumb">üè∫<div class="photo-thumb-meta">Clay mortar</div></div>
          <div class="photo-thumb">üå∫<div class="photo-thumb-meta">Drying rack</div></div>
          <div class="photo-thumb">üåø<div class="photo-thumb-meta">Herb #7</div></div>
          <div class="photo-thumb" style="font-size:13px;color:var(--ink-muted)">+8</div>
        </div>

        <p>
          The <a class="concept-tag">üåø Ritual Practices</a> associated with preparation are as significant as the botanical knowledge.
          Each plant is prepared with a specific chant (called a <em>mantra kalawa</em>), and the grinding
          process itself follows a directional logic‚Äîalways clockwise for tonics, counter-clockwise for purgatives.
          This ritual framework mirrors practices documented in the <a class="location-tag">üìç Ella Caves Survey</a>,
          raising the possibility of shared cultural origin.
        </p>

        <hr class="h-rule">

        <p style="font-family:'DM Sans',sans-serif;font-size:13px;color:var(--ink-muted);padding:12px;background:var(--parchment);border-radius:8px;border-left:3px solid var(--amber)">
          <strong style="color:var(--amber)">üîó Graph Note:</strong>
          This interview creates 3 new cross-links: Kandy ‚Üî Galle (via "Traditional Medicine"),
          Priya Ratnam ‚Üî Nimal Bandara (co-mention), Ella ‚Üî Kandy (Ritual Practice).
          <span style="color:var(--coral);cursor:pointer;text-decoration:underline" onclick="showGraph()">View in Graph ‚Üí</span>
        </p>
      </div>
    </div>
  </div>

  <!-- Entity Panel (Right) -->
  <div class="entity-panel">
    <div class="entity-panel-header">
      <div class="ep-title">Context Panel</div>
      <div style="display:flex;gap:4px">
        <button class="icon-btn">‚Üó</button>
        <button class="icon-btn">‚ãÆ</button>
      </div>
    </div>

    <div class="ep-tabs">
      <button class="ep-tab active">Entity</button>
      <button class="ep-tab">Linked</button>
      <button class="ep-tab">Map</button>
      <button class="ep-tab">Gear</button>
    </div>

    <div class="ep-body">
      <!-- Entity Profile -->
      <div class="entity-profile">
        <div class="ep-avatar-row">
          <div class="ep-avatar">PR</div>
          <div>
            <div class="ep-name">Priya Ratnam</div>
            <div class="ep-role">Ayurvedic Practitioner ¬∑ Kandy</div>
          </div>
        </div>

        <div class="ep-stats">
          <div class="ep-stat">
            <div class="ep-stat-num">7</div>
            <div class="ep-stat-lbl">Mentions</div>
          </div>
          <div class="ep-stat">
            <div class="ep-stat-num">3</div>
            <div class="ep-stat-lbl">Sessions</div>
          </div>
          <div class="ep-stat">
            <div class="ep-stat-num">4</div>
            <div class="ep-stat-lbl">Concepts</div>
          </div>
        </div>

        <div style="font-size:11px;color:var(--ink-muted);margin-bottom:8px;font-weight:600;text-transform:uppercase;letter-spacing:0.08em">Associated Topics</div>
        <div class="ep-topics">
          <span class="ep-topic">Traditional Medicine</span>
          <span class="ep-topic">Lunar Harvesting</span>
          <span class="ep-topic">Ritual Practice</span>
          <span class="ep-topic">Sida rhombifolia</span>
          <span class="ep-topic">Mantra Kalawa</span>
        </div>
      </div>

      <!-- Map Preview -->
      <div class="mini-map">
        <div class="mini-map-header">
          <span class="mini-map-title">üìç Location</span>
          <button class="icon-btn" style="height:24px;width:24px;font-size:12px">‚§¢</button>
        </div>
        <div class="map-view">
          <!-- Simulated Map -->
          <div class="map-roads">
            <div class="map-road" style="width:100%;height:2px;top:55%;background:rgba(255,255,255,0.4)"></div>
            <div class="map-road" style="width:2px;height:100%;left:40%;background:rgba(255,255,255,0.3)"></div>
            <div class="map-road" style="width:60%;height:2px;top:35%;left:20%;transform:rotate(-8deg);background:rgba(255,255,255,0.25)"></div>
          </div>
          <!-- Kandy pin (active) -->
          <div class="map-pin" style="left:42%;top:45%">
            <div class="map-pin-dot" style="background:var(--coral)"></div>
            <div class="map-pin-pulse" style="border-color:var(--coral)"></div>
          </div>
          <!-- Galle pin -->
          <div class="map-pin" style="left:25%;top:72%">
            <div class="map-pin-dot" style="background:var(--sage)"></div>
            <div class="map-pin-pulse" style="border-color:var(--sage)"></div>
          </div>
          <!-- Ella pin -->
          <div class="map-pin" style="left:60%;top:65%">
            <div class="map-pin-dot" style="background:var(--amber)"></div>
            <div class="map-pin-pulse" style="border-color:var(--amber)"></div>
          </div>
          <!-- Connection line Kandy-Galle -->
          <svg style="position:absolute;inset:0;width:100%;height:100%;pointer-events:none" viewBox="0 0 260 140">
            <line x1="109" y1="63" x2="65" y2="101" stroke="rgba(207,106,76,0.5)" stroke-width="1.5" stroke-dasharray="4,3"/>
            <line x1="109" y1="63" x2="156" y2="91" stroke="rgba(196,132,74,0.4)" stroke-width="1.5" stroke-dasharray="4,3"/>
          </svg>
          <!-- Legend -->
          <div style="position:absolute;bottom:6px;left:8px;display:flex;flex-direction:column;gap:3px">
            <div style="display:flex;align-items:center;gap:4px;font-size:9px;color:rgba(42,36,32,0.7);font-family:'DM Sans',sans-serif">
              <div style="width:7px;height:7px;border-radius:50%;background:var(--coral)"></div>Kandy (active)
            </div>
            <div style="display:flex;align-items:center;gap:4px;font-size:9px;color:rgba(42,36,32,0.7);font-family:'DM Sans',sans-serif">
              <div style="width:7px;height:7px;border-radius:50%;background:var(--sage)"></div>Galle
            </div>
          </div>
        </div>
      </div>

      <!-- Inventory Alert -->
      <div class="inv-alert">
        <div class="inv-alert-icon">‚ö†</div>
        <div class="inv-alert-text">Items need attention</div>
        <div class="inv-alert-count">2</div>
      </div>

      <!-- Inventory -->
      <div class="inventory-card">
        <div class="inv-header">
          <div class="inv-title">üéí Field Kit Status</div>
          <div class="inv-readiness">4/6 Ready</div>
        </div>
        <div class="inv-item">
          <div class="inv-item-icon">üì∑</div>
          <div class="inv-item-name">Camera (Sony A7)</div>
          <div class="inv-status status-charged">‚úì Charged</div>
        </div>
        <div class="inv-item">
          <div class="inv-item-icon">üéô</div>
          <div class="inv-item-name">External Mic</div>
          <div class="inv-status status-charged">‚úì Ready</div>
        </div>
        <div class="inv-item" style="background:rgba(196,132,74,0.04)">
          <div class="inv-item-icon">üîã</div>
          <div class="inv-item-name">Powerbank</div>
          <div class="inv-status status-low">‚ö° Low</div>
        </div>
        <div class="inv-item">
          <div class="inv-item-icon">üíæ</div>
          <div class="inv-item-name">SD Cards (√ó3)</div>
          <div class="inv-status status-charged">‚úì Packed</div>
        </div>
        <div class="inv-item" style="background:rgba(207,106,76,0.04)">
          <div class="inv-item-icon">üéß</div>
          <div class="inv-item-name">Headphones</div>
          <div class="inv-status status-missing">‚úó Missing</div>
        </div>
        <div class="inv-item">
          <div class="inv-item-icon">üìì</div>
          <div class="inv-item-name">Field Notebook</div>
          <div class="inv-status status-charged">‚úì Packed</div>
        </div>
      </div>

      <!-- Connected Notes -->
      <div style="font-size:11px;color:var(--ink-muted);margin-bottom:8px;font-weight:600;text-transform:uppercase;letter-spacing:0.08em;padding:0 2px">
        üîó Connected Notes
      </div>

      <div class="connected-note">
        <div class="cn-icon">üåä</div>
        <div class="cn-info">
          <div class="cn-title">Galle Coastal Plant Survey</div>
          <div class="cn-meta">via "Traditional Medicine"</div>
        </div>
        <div class="cn-strength">
          <div class="strength-bar" style="background:var(--coral);opacity:1"></div>
          <div class="strength-bar" style="background:var(--coral);opacity:0.7"></div>
          <div class="strength-bar" style="background:var(--coral);opacity:0.4"></div>
        </div>
      </div>

      <div class="connected-note">
        <div class="cn-icon">üèî</div>
        <div class="cn-info">
          <div class="cn-title">Ritual Ceremony Documentation</div>
          <div class="cn-meta">via "Ritual Practices"</div>
        </div>
        <div class="cn-strength">
          <div class="strength-bar" style="background:var(--coral);opacity:1"></div>
          <div class="strength-bar" style="background:var(--coral);opacity:0.7"></div>
          <div class="strength-bar" style="background:var(--sand-dark)"></div>
        </div>
      </div>

      <div class="connected-note">
        <div class="cn-icon">üó£</div>
        <div class="cn-info">
          <div class="cn-title">Market Vendor Conversations</div>
          <div class="cn-meta">via "Trade Routes"</div>
        </div>
        <div class="cn-strength">
          <div class="strength-bar" style="background:var(--amber);opacity:1"></div>
          <div class="strength-bar" style="background:var(--sand-dark)"></div>
          <div class="strength-bar" style="background:var(--sand-dark)"></div>
        </div>
      </div>

    </div>
  </div>

</div><!-- end app-body -->

<!-- Status Bar -->
<div class="status-bar">
  <div class="status-item">
    <div class="status-dot" style="background:var(--sage)"></div>
    Synced to Cloud
  </div>
  <div class="status-item">üìç GPS Active</div>
  <div class="status-item">47 Notes ¬∑ 14 Entities ¬∑ 23 Locations</div>
  <div style="flex:1"></div>
  <div class="status-item">
    <span style="font-family:'JetBrains Mono',monospace">SQLite: 248 KB</span>
  </div>
  <div class="status-item">Rust 1.78 ¬∑ Tauri 2.0</div>
</div>

<!-- Knowledge Graph Overlay -->
<div class="graph-overlay" id="graphOverlay">
  <div class="graph-header">
    <div style="display:flex;align-items:center;gap:16px">
      <div class="graph-title">üï∏ Knowledge Graph</div>
      <div style="display:flex;gap:8px">
        <button style="padding:5px 12px;border-radius:20px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.06);color:rgba(250,247,242,0.7);font-size:11.5px;cursor:pointer;font-family:'DM Sans',sans-serif" onclick="filterGraph('all')">All</button>
        <button style="padding:5px 12px;border-radius:20px;border:1px solid rgba(207,106,76,0.5);background:rgba(207,106,76,0.15);color:var(--coral-light);font-size:11.5px;cursor:pointer;font-family:'DM Sans',sans-serif">Interviews</button>
        <button style="padding:5px 12px;border-radius:20px;border:1px solid rgba(107,140,122,0.5);background:rgba(107,140,122,0.1);color:var(--sage-light);font-size:11.5px;cursor:pointer;font-family:'DM Sans',sans-serif">Concepts</button>
        <button style="padding:5px 12px;border-radius:20px;border:1px solid rgba(196,132,74,0.5);background:rgba(196,132,74,0.1);color:var(--amber-light);font-size:11.5px;cursor:pointer;font-family:'DM Sans',sans-serif">Locations</button>
      </div>
    </div>
    <button class="graph-close" onclick="hideGraph()">‚úï</button>
  </div>

  <div class="graph-canvas">
    <svg class="graph-svg" id="graphSvg" viewBox="0 0 900 560">
      <!-- Edges -->
      <g id="edges">
        <!-- Traditional Medicine connections -->
        <line x1="450" y1="280" x2="250" y2="160" class="edge-line" stroke="rgba(107,140,122,0.5)" stroke-dasharray="none"/>
        <line x1="450" y1="280" x2="660" y2="200" class="edge-line" stroke="rgba(107,140,122,0.5)"/>
        <line x1="450" y1="280" x2="350" y2="390" class="edge-line" stroke="rgba(107,140,122,0.4)"/>
        <line x1="450" y1="280" x2="580" y2="390" class="edge-line" stroke="rgba(107,140,122,0.35)"/>
        <!-- Kandy-Galle link -->
        <line x1="250" y1="160" x2="660" y2="200" class="edge-line" stroke="rgba(207,106,76,0.4)" stroke-dasharray="6,4"/>
        <!-- Entity links -->
        <line x1="250" y1="160" x2="140" y2="300" class="edge-line" stroke="rgba(207,106,76,0.3)"/>
        <line x1="660" y1="200" x2="780" y2="340" class="edge-line" stroke="rgba(207,106,76,0.3)"/>
        <line x1="350" y1="390" x2="140" y2="300" class="edge-line" stroke="rgba(196,132,74,0.3)"/>
        <line x1="580" y1="390" x2="720" y2="460" class="edge-line" stroke="rgba(196,132,74,0.25)"/>
        <line x1="250" y1="160" x2="350" y2="390" class="edge-line" stroke="rgba(207,106,76,0.2)"/>
        <line x1="450" y1="280" x2="720" y2="460" class="edge-line" stroke="rgba(107,140,122,0.2)"/>
        <!-- More connections -->
        <line x1="140" y1="300" x2="580" y2="390" class="edge-line" stroke="rgba(196,132,74,0.2)" stroke-dasharray="4,4"/>
        <line x1="660" y1="200" x2="580" y2="390" class="edge-line" stroke="rgba(107,140,122,0.25)"/>
      </g>

      <!-- Concept Nodes (larger) -->
      <g class="graph-node" transform="translate(450,280)">
        <circle r="36" fill="rgba(107,140,122,0.9)" filter="url(#glow-sage)"/>
        <circle r="36" fill="none" stroke="rgba(139,168,152,0.6)" stroke-width="1.5"/>
        <text class="node-label" text-anchor="middle" dy="4" font-size="12" font-weight="600">Traditional</text>
        <text class="node-label" text-anchor="middle" dy="18" font-size="12" font-weight="600">Medicine</text>
      </g>

      <g class="graph-node" transform="translate(350,390)">
        <circle r="24" fill="rgba(107,140,122,0.7)"/>
        <text class="node-label" text-anchor="middle" dy="-4" font-size="10" font-weight="600">Ritual</text>
        <text class="node-label" text-anchor="middle" dy="9" font-size="10" font-weight="600">Practices</text>
      </g>

      <g class="graph-node" transform="translate(580,390)">
        <circle r="22" fill="rgba(107,140,122,0.65)"/>
        <text class="node-label" text-anchor="middle" dy="4" font-size="10" font-weight="600">Lunar Harvest</text>
      </g>

      <g class="graph-node" transform="translate(720,460)">
        <circle r="18" fill="rgba(107,140,122,0.55)"/>
        <text class="node-label" text-anchor="middle" dy="4" font-size="9.5">Trade Routes</text>
      </g>

      <!-- Location Nodes -->
      <g class="graph-node" transform="translate(250,160)">
        <circle r="30" fill="rgba(207,106,76,0.88)"/>
        <circle r="30" fill="none" stroke="rgba(224,123,90,0.5)" stroke-width="2" stroke-dasharray="none">
          <animate attributeName="r" from="30" to="44" dur="2.5s" repeatCount="indefinite"/>
          <animate attributeName="opacity" from="0.5" to="0" dur="2.5s" repeatCount="indefinite"/>
        </circle>
        <text class="node-label" text-anchor="middle" dy="-3" font-weight="600">üìç Kandy</text>
        <text class="node-label" text-anchor="middle" dy="11" font-size="9.5" opacity="0.8">7 notes</text>
      </g>

      <g class="graph-node" transform="translate(660,200)">
        <circle r="26" fill="rgba(207,106,76,0.78)"/>
        <text class="node-label" text-anchor="middle" dy="-3" font-weight="600">üìç Galle</text>
        <text class="node-label" text-anchor="middle" dy="11" font-size="9.5" opacity="0.8">5 notes</text>
      </g>

      <g class="graph-node" transform="translate(500,80)">
        <circle r="20" fill="rgba(207,106,76,0.65)"/>
        <text class="node-label" text-anchor="middle" dy="4" font-size="10">üìç Ella</text>
      </g>

      <g class="graph-node" transform="translate(160,110)">
        <circle r="17" fill="rgba(207,106,76,0.55)"/>
        <text class="node-label" text-anchor="middle" dy="4" font-size="9.5">üìç Peradeniya</text>
      </g>

      <!-- Entity (person) Nodes -->
      <g class="graph-node" transform="translate(140,300)">
        <circle r="26" fill="rgba(196,132,74,0.85)"/>
        <text class="node-label" text-anchor="middle" dy="-3" font-weight="600">üë§ Priya</text>
        <text class="node-label" text-anchor="middle" dy="11" font-size="9.5">Ratnam</text>
      </g>

      <g class="graph-node" transform="translate(780,340)">
        <circle r="22" fill="rgba(196,132,74,0.75)"/>
        <text class="node-label" text-anchor="middle" dy="-3" font-size="10" font-weight="600">üë§ Nimal</text>
        <text class="node-label" text-anchor="middle" dy="11" font-size="9.5">Bandara</text>
      </g>

      <g class="graph-node" transform="translate(75,440)">
        <circle r="18" fill="rgba(196,132,74,0.6)"/>
        <text class="node-label" text-anchor="middle" dy="4" font-size="9.5">üë§ Elder</text>
      </g>

      <g class="graph-node" transform="translate(820,160)">
        <circle r="16" fill="rgba(196,132,74,0.55)"/>
        <text class="node-label" text-anchor="middle" dy="4" font-size="9.5">üë§ Vendors</text>
      </g>

      <!-- Artifact node -->
      <g class="graph-node" transform="translate(760,80)">
        <circle r="15" fill="rgba(196,132,74,0.5)"/>
        <text class="node-label" text-anchor="middle" dy="4" font-size="9">üíä Sida r.</text>
      </g>

      <!-- Connection highlight (Kandy ‚Üî Galle dashed) -->
      <text x="430" y="178" fill="rgba(207,106,76,0.6)" font-size="10" font-family="DM Sans, sans-serif" text-anchor="middle">linked via Traditional Medicine</text>

      <!-- Filter definitions -->
      <defs>
        <filter id="glow-sage">
          <feGaussianBlur stdDeviation="4" result="blur"/>
          <feComposite in="SourceGraphic" in2="blur" operator="over"/>
        </filter>
      </defs>
    </svg>

    <!-- Legend -->
    <div class="graph-legend">
      <div class="legend-item">
        <div class="legend-dot" style="background:rgba(207,106,76,0.9)"></div>
        Locations
      </div>
      <div class="legend-item">
        <div class="legend-dot" style="background:rgba(107,140,122,0.9)"></div>
        Concepts
      </div>
      <div class="legend-item">
        <div class="legend-dot" style="background:rgba(196,132,74,0.9)"></div>
        People / Entities
      </div>
      <div class="legend-item">
        <div style="width:24px;height:1.5px;border-top:1.5px dashed rgba(250,247,242,0.4)"></div>
        Cross-region link
      </div>
    </div>

    <!-- Graph Controls -->
    <div class="graph-controls">
      <button class="graph-ctrl-btn">+</button>
      <button class="graph-ctrl-btn">‚àí</button>
      <button class="graph-ctrl-btn">‚ü≥</button>
    </div>
  </div>
</div>

<script>
  // Generate waveform bars
  const waveform = document.getElementById('waveform');
  const heights = [6,9,14,18,22,16,20,24,18,14,20,18,24,20,16,22,18,14,20,24,18,16,20,14,18,22,16,18,24,20,14,16,22,18,20,14,18,16,22,20,18,24,16,14,20,18,22,14];
  heights.forEach((h, i) => {
    const bar = document.createElement('div');
    bar.className = 'wave-bar';
    bar.style.cssText = `--h:${h}px;--dur:${0.6+Math.random()*0.8}s;--delay:${i*0.03}s;`;
    waveform.appendChild(bar);
  });

  // Graph overlay
  function showGraph() {
    document.getElementById('graphOverlay').classList.add('visible');
  }

  function hideGraph() {
    document.getElementById('graphOverlay').classList.remove('visible');
  }

  // Offline toggle simulation
  let isOffline = false;
  function toggleOffline() {
    isOffline = !isOffline;
    const dot = document.getElementById('syncDot');
    const text = document.getElementById('syncText');
    const btn = document.getElementById('offlineToggle');
    if (isOffline) {
      dot.style.background = 'var(--amber)';
      text.textContent = 'Offline ¬∑ Local SQLite';
      btn.style.color = 'var(--amber)';
    } else {
      dot.style.background = 'var(--sage)';
      text.textContent = 'Synced ¬∑ 2 min ago';
      btn.style.color = '';
    }
  }

  // Note card clicks
  document.querySelectorAll('.note-card').forEach(card => {
    card.addEventListener('click', function() {
      document.querySelectorAll('.note-card').forEach(c => c.classList.remove('active'));
      this.classList.add('active');
    });
  });

  // EP tabs
  document.querySelectorAll('.ep-tab').forEach(tab => {
    tab.addEventListener('click', function() {
      document.querySelectorAll('.ep-tab').forEach(t => t.classList.remove('active'));
      this.classList.add('active');
    });
  });

  // Rail icons
  document.querySelectorAll('.rail-icon').forEach(icon => {
    icon.addEventListener('click', function() {
      document.querySelectorAll('.rail-icon').forEach(i => i.classList.remove('active'));
      this.classList.add('active');
    });
  });

  // Sidebar items
  document.querySelectorAll('.sb-item').forEach(item => {
    item.addEventListener('click', function() {
      document.querySelectorAll('.sb-section:first-of-type .sb-item').forEach(i => i.classList.remove('active'));
      this.classList.add('active');
    });
  });

  // Note heading auto-resize
  const heading = document.querySelector('.note-heading');
  if (heading) {
    heading.style.height = heading.scrollHeight + 'px';
  }

  // Animate waveform on play
  document.querySelector('.audio-play-btn').addEventListener('click', function() {
    const bars = waveform.querySelectorAll('.wave-bar');
    bars.forEach(bar => {
      bar.style.animationPlayState = bar.style.animationPlayState === 'paused' ? 'running' : 'paused';
    });
    this.textContent = this.textContent === '‚ñ∂' ? '‚è∏' : '‚ñ∂';
  });
</script>

</body>
</html>
